ﾟωﾟﾉ = /｀ｍ´）ﾉ ~┻━┻   //*´∇｀*/ ['_'];
o = (ﾟｰﾟ) = _ = 3;
c = (ﾟΘﾟ) = (ﾟｰﾟ) - (ﾟｰﾟ);
(ﾟДﾟ) = (ﾟΘﾟ) = (o ^ _ ^ o) / (o ^ _ ^ o);
(ﾟДﾟ) = {
    ﾟΘﾟ: '_',
    ﾟωﾟﾉ: ((ﾟωﾟﾉ == 3) + '_') [ﾟΘﾟ],
    ﾟｰﾟﾉ: (ﾟωﾟﾉ + '_')[o ^ _ ^ o - (ﾟΘﾟ)],
    ﾟДﾟﾉ: ((ﾟｰﾟ == 3) + '_')[ﾟｰﾟ]
};
(ﾟДﾟ) [ﾟΘﾟ] = ((ﾟωﾟﾉ == 3) + '_') [c ^ _ ^ o];
(ﾟДﾟ) ['c'] = ((ﾟДﾟ) + '_') [(ﾟｰﾟ) + (ﾟｰﾟ) - (ﾟΘﾟ)];
(ﾟДﾟ) ['o'] = ((ﾟДﾟ) + '_') [ﾟΘﾟ];
(ﾟoﾟ) = (ﾟДﾟ) ['c'] + (ﾟДﾟ) ['o'] + (ﾟωﾟﾉ + '_')[ﾟΘﾟ] + ((ﾟωﾟﾉ == 3) + '_') [ﾟｰﾟ] + ((ﾟДﾟ) + '_') [(ﾟｰﾟ) + (ﾟｰﾟ)] + ((ﾟｰﾟ == 3) + '_') [ﾟΘﾟ] + ((ﾟｰﾟ == 3) + '_') [(ﾟｰﾟ) - (ﾟΘﾟ)] + (ﾟДﾟ) ['c'] + ((ﾟДﾟ) + '_') [(ﾟｰﾟ) + (ﾟｰﾟ)] + (ﾟДﾟ) ['o'] + ((ﾟｰﾟ == 3) + '_') [ﾟΘﾟ];
(ﾟДﾟ) ['_'] = (o ^ _ ^ o) [ﾟoﾟ] [ﾟoﾟ];
(ﾟεﾟ) = ((ﾟｰﾟ == 3) + '_') [ﾟΘﾟ] + (ﾟДﾟ).ﾟДﾟﾉ + ((ﾟДﾟ) + '_') [(ﾟｰﾟ) + (ﾟｰﾟ)] + ((ﾟｰﾟ == 3) + '_') [o ^ _ ^ o - ﾟΘﾟ] + ((ﾟｰﾟ == 3) + '_') [ﾟΘﾟ] + (ﾟωﾟﾉ + '_') [ﾟΘﾟ];
(ﾟｰﾟ) += (ﾟΘﾟ);
(ﾟДﾟ)[ﾟεﾟ] = '\\';
(ﾟДﾟ).ﾟΘﾟﾉ = (ﾟДﾟ + ﾟｰﾟ)[o ^ _ ^ o - (ﾟΘﾟ)];
(oﾟｰﾟo) = (ﾟωﾟﾉ + '_')[c ^ _ ^ o];
(ﾟДﾟ) [ﾟoﾟ] = '\"';
(ﾟДﾟ) ['_']((ﾟДﾟ) ['_'](ﾟεﾟ + (ﾟДﾟ)[ﾟoﾟ] + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (c ^ _ ^ o) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (ﾟΘﾟ)) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((ﾟｰﾟ) + (o ^ _ ^ o)) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟｰﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (o ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (o ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟｰﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟｰﾟ) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟｰﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (o ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + (ﾟｰﾟ) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟｰﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((o ^ _ ^ o) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + ((o ^ _ ^ o) + (o ^ _ ^ o)) + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (c ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟｰﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (ﾟΘﾟ)) + (ﾟΘﾟ) + (ﾟДﾟ)[ﾟεﾟ] + ((ﾟｰﾟ) + (o ^ _ ^ o)) + (o ^ _ ^ o) + (ﾟДﾟ)[ﾟεﾟ] + (ﾟΘﾟ) + ((o ^ _ ^ o) - (ﾟΘﾟ)) + (ﾟДﾟ)[ﾟoﾟ])(ﾟΘﾟ))('_');


//所有的数据记录数
var dataTotal;

//每页加载的条数
var pageCount = 10
/**
 * 当前页
 */
var currentPage;

$(function () {
    getDataForNet(1)

})

function getDataForNet(pageNumber) {

    currentPage = pageNumber

    var emp = Bmob.Object.extend("Emp");
    var query = new Bmob.Query(emp);
    // 返回最多10条数据
    query.limit(pageCount);
    query.skip((pageNumber - 1) * pageCount)
    // createdAt
    query.descending("createdAt");

// 查询所有数据
    query.find({
        success: function (results) {
            console.log("共查询到 " + results.length + " 条记录");

            //拼接emp表格
            bulidTable(results)

            //拼接分页info
            bulidPageInfo(results)
            //拼接分页条目
            bulidPageNav(results)

        },
        error: function (error) {
            console.log("查询失败: " + error.code + " " + error.message);
        }
    });
}


//拼接分页条目
function bulidPageNav(res) {

    $("#page_nav").empty()

    var ulEle = $("<ul></ul>").addClass("pagination")

    if (currentPage > 1) {

        var homePage = $("<li></li>").append($("<a></a>").css("cursor", "pointer").append("首页"))
        var prePage = $("<li></li>").append($("<a></a>").css("cursor", "pointer").attr("aria-label", "Previous").append("上一页"))

        homePage.click(function () {
            getDataForNet(1)
        })
        prePage.click(function () {
            getDataForNet(currentPage - 1)
        })
        ulEle.append(homePage).append(prePage)
    }

    var lastPageNum = Math.ceil((dataTotal / pageCount))

    if (currentPage != lastPageNum) {
        var nextPage = $("<li></li>").append($("<a></a>").css("cursor", "pointer").attr("aria-label", "Next").append("下一页"))

        var lastPage = $("<li></li>").append($("<a></a>").css("cursor", "pointer").append("尾页"))

        nextPage.click(function () {
            getDataForNet(currentPage + 1)
        })

        lastPage.click(function () {
            getDataForNet(lastPageNum)
        })
        ulEle.append(nextPage).append(lastPage).appendTo("#page_nav")
    } else {
        ulEle.appendTo("#page_nav")
    }


}


//拼接分页信息
function bulidPageInfo(res) {
    $("#text-page-info").empty()

    var Emp = Bmob.Object.extend("Emp");
    var query = new Bmob.Query(Emp);

    query.count({
        success: function (count) {
            // 查询成功，返回记录数量
            // var currentPageNum = res[res.length - 1].get("currentItemNum") / pageCount + 1;

            // console.log("currentPageNum:"+res[res.length - 1].get("currentItemNum"));

            $("#text-page-info").append("当前第" + currentPage + "页 共有"
                + Math.ceil((count / pageCount)) + "页 总计" + count + "条记录")

            dataTotal = count
            // currentPage = currentPageNum
        },
        error: function (error) {
            // 查询失败
        }
    });


}

//拼接table格式
function bulidTable(res) {
    $("#table_emp tbody").empty()

    $.each(res, function (i, item) {

        var empCheckbox = $("<td></td>").append($("<input type='checkbox' class='check-td-item'>"));
        var empIdTd = $("<td></td>").append(item.id);
        var empNameTd = $("<td></td>").append(item.get("empName"));
        var empGenderTd = $("<td></td>").append(item.get("empGender") == "M" ? "男" : "女");
        var empEmailTd = $("<td></td>").append(item.get("empEmail"));


        var dept = Bmob.Object.extend("Dept");
        var deptQuery = new Bmob.Query(dept);
        // 对id字段升序排列
        deptQuery.equalTo("objectId", item.get("deptId"));

        console.log("deptId::" + item.get("deptId"));

        // 查询所有数据
        deptQuery.find({
            success: function (deptResults) {
                console.log("共查询到部门 " + deptResults.length + " 条记录");

                if (deptResults.length > 0) {
                    var deptNameTd = $("<td></td>").append(deptResults[0].get("name"));

                    var editBtn = $("<td></td>").append($("<button></button>")
                        .addClass("btn btn-info btn-edit").attr("edit_id", item.id).append("<span></span>")
                        .addClass("glyphicon glyphicon-pencil").append("编辑"))
                        .append("\t\t")
                        .append($("<button></button>")
                            .addClass("btn btn-danger").append("<span></span>")
                            .addClass("glyphicon glyphicon-trash btn-del").attr("del_id", item.id).append("删除"));

                    $("<tr></tr>")
                        .append(empCheckbox)
                        .append(empIdTd)
                        .append(empNameTd)
                        .append(empEmailTd)
                        .append(empGenderTd)
                        .append(deptNameTd)
                        .append(editBtn)
                        .appendTo("#table_emp tbody")
                }
            },
            error: function (error) {
                console.log("查询失败: " + error.code + " " + error.message);
            }
        });


    })
}


/**
 * 添加用户
 */
$("#btn_add_emp").click(function () {
    //获取所有的部门
    getDepts("#myModal select");

    //显示模态框
    $('#myModal').modal({
        backdrop: "static",
    })
})

/**
 * 获取所有部门
 * @param ele
 */
function getDepts(ele) {

    var dept = Bmob.Object.extend("Dept");
    var query = new Bmob.Query(dept);
    // 对id字段升序排列
    query.ascending("id");

    // 查询所有数据
    query.find({
        success: function (results) {
            console.log("共查询到部门 " + results.length + " 条记录");

            $(ele).empty()

            $.each(results, function (i, item) {
                if (item.get("name") != null) {
                    var optionEle = $("<option></option>")
                        .attr("value", item.id).append(item.get("name"))

                    console.log(item.get("name"));

                    optionEle.appendTo(ele)
                }

            })

        },
        error: function (error) {
            console.log("查询失败: " + error.code + " " + error.message);
        }
    });
}


$("#btn_add_close").click(function () {
    $('#myModal').modal('hide')
})

$("#btn_add_save").click(function () {
    if (!checkAddEmpName() || !checkAddEmail() || $(this).attr("empNameIsUse") == "error") {
        alert("请检查上方是否有错误")

        return false;
    }
//创建类和实例
    var Emp = Bmob.Object.extend("Emp");
    var emp = new Emp();
    emp.set("empName", $("#add_empName").val());
    emp.set("empEmail", $("#add_email").val());
    emp.set("empGender", $("input:radio[name='empGender']:checked").val());
    emp.set("deptId", $("#select_add_dId").val());


    console.log("deptId" + $("#select_add_dId").val());
    console.log("empGender" + $("input:radio[name='empGender']:checked").val());
    console.log("empEmail" + $("#add_email").val());
    console.log("empName" + $("#add_empName").val());


    //添加数据，第一个入口参数是null
    emp.save(null, {
        success: function (gameScore) {
            // 添加成功，返回成功之后的objectId（注意：返回的属性名字是id，不是objectId），你还可以在Bmob的Web管理后台看到对应的数据
            //关闭模态框
            $('#myModal').modal('hide')
            getDataForNet(1)
            //清空添加form表单
            $("#myModal form")[0].reset()
        },
        error: function (gameScore, error) {
            // 添加失败
            alert('添加数据失败，返回错误信息：' + error.description);
        }
    });
})


$("#add_empName").blur(function () {
    // console.log("empname blur");
    // console.log(checkAddEmpName($(this).val()));

    changeStatus($(this), checkAddEmpName(), "姓名格式为6-16位英文字符，3-5位中文", false)

    if (checkAddEmpName()) {
        //检查是否可用
        checkAddEmpNameIsUse()
    }

})

function checkAddEmpNameIsUse() {

    if ($("#add_empName").val() == "") {
        changeStatus($("#add_empName"), false, "用户名不可空", true)
        return;
    }

    var currentEmpName = $("#add_empName").val();

    var emp = Bmob.Object.extend("Emp");
    var query = new Bmob.Query(emp);
    // 返回最多10条数据
    // createdAt
    query.ascending("createdAt");

// 查询所有数据
    query.find({
        success: function (results) {
            console.log("共查询到 " + results.length + " 条记录");

            var flag = true;

            for (var i = 0; i < results.length; i++) {
                if (results[i].get("empName") == currentEmpName) {
                    flag = false;
                    break;
                } else {
                    flag = true;
                }
            }

            if (!flag) {
                $("#btn_add_save").attr("empNameIsUse", "error");
                console.log("用户名不可用");
                changeStatus($("#add_empName"), false, "用户名不可用", true)
            } else {
                $("#btn_add_save").attr("empNameIsUse", "success");

                changeStatus($("#add_empName"), true, "用户名可用", true)
                console.log("用户名可用");
            }

        },
        error: function (error) {
            console.log("查询失败: " + error.code + " " + error.message);
        }
    });
}

$("#add_email").blur(function () {
    // console.log("add_email blur" + $(this).val());
    // console.log(checkAddEmail($(this).val()));

    changeStatus($(this), checkAddEmail(), "邮箱格式不正确", false)
})

// .has-error 或 .has-success

/**
 *修改UI状态
 * @param ele 元素
 * @param isSuccess 是否是成功状态
 * @param msg 要显示的错误/成功信息
 * @param isChackNamUse 是否是检测用户名可用
 */
function changeStatus(ele, isSuccess, msg, isChackNamUse) {
    console.log(ele + isSuccess);

    ele.parent().removeClass("has-error has-success")
    ele.next("span").text("")
    if (isSuccess) {
        ele.parent().addClass("has-success")
        if (isChackNamUse) {
            ele.next("span").text(msg)
        } else {
            ele.next("span").text("")

        }
    } else {
        ele.parent().addClass("has-error")
        ele.next("span").text(msg)

    }

}

//校验姓名
function checkAddEmpName() {
    //6-16位英文字符，3-5位中文
    var rexEmpName = /(^[a-z0-9_-]{6,16}$)|(^[\u2E80-\u9FFF]{2,3})/

    return rexEmpName.test($("#add_empName").val())
}


//校验姓名
function checkAddEmail() {
    var rexEmail = /^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/

    return rexEmail.test($("#add_email").val())
}


//  编辑模态框  编辑模态框     编辑模态框  编辑模态框  编辑模态框  编辑模态框
$(document).on("click", ".btn-edit", function () {

    console.log("click - btn - edit");
    getDepts("#updateDialog select")


    //显示模态框
    $('#updateDialog').modal({
        backdrop: "static"
    })

    var empId = $(this).attr("edit_id")

    //存储id
    $("#btn_update_save").attr("update_save_id", empId)

    //查询数据显示在页面上
    getEmpById(empId);
})

$(document).on("click", ".btn-del", function () {
    var empName = $(this).parents("tr").find("td:eq(2)").text()

    if (confirm("是否删除【" + empName + "】？")) {
        $.ajax({
            url: "${appPath}/emp/delEmp/" + $(this).attr("del_id") + ".do",
            type: "GET",
            dataType: "json",
            success: function (result) {
                alert("删除成功")
                getDataForNet(currentPage)
            }
        })
    }


})


function getEmpById(id) {
    $.ajax({
        url: "${appPath}/emp/empById/" + id + ".do",
        type: "GET",
        dataType: "json",
        success: function (result) {
            console.log(result);
            if (result.resultCode == 200) {
                var emp = result.resultBody.emp
                $("#update_empName").val(emp.empName)
                $("#update_email").val(emp.empEmail)

                $("#updateDialog form :radio[value=" + emp.empGender + "]").attr("checked", true)

                $("#updateDialog form  option[value=" + emp.dId + "]").attr("selected", "selected")

            }

        }

    })
}


$("#btn_update_close").click(function () {
    $('#updateDialog').modal('hide')
})

$("#btn_update_save").click(function () {

    $.ajax({
        url: "${appPath}/emp/updateEmp.do",
        data: $("#form-update-emp").serialize() + "&empId=" + $(this).attr("update_save_id"),
        type: "POST",
        dataType: "json",
        success: function (result) {
            $('#updateDialog').modal('hide')
            getDataForNet(currentPage)
        }

    })
})

//-----------全选------------------
$("#select-all").click(function () {
    console.log("select-all");


    $(".check-td-item").prop("checked", $("#select-all").prop("checked"))

})
//-----------全选/全不选------------------
$(document).on("click", ".check-td-item", function () {
    $("#select-all").prop("checked", $(".check-td-item:checked").length == $(".check-td-item").length)
})

//全部删除
$(".btn_all_del").click(function () {

    var names = [];
    var ids = [];


    //获取所有被选中的item
    $(".check-td-item:checked").each(function (i, item) {
        var name = $(item).parents("tr").find("td:eq(2)").text();
        var id = $(item).parents("tr").find("td:eq(1)").text();
        names[i] = name
        ids[i] = id
    })

    if (names.length == 0) {
        alert("请先选择要删除的列")

        return;
    }

    if (confirm("是否删除【" + names + "】？")) {





        $.each(ids, function (i, item) {
            var Emp = Bmob.Object.extend("Emp");
            var query = new Bmob.Query(Emp);

            query.get(item, {
                success: function(object) {
                    // The object was retrieved successfully.
                    object.destroy({
                        success: function(deleteObject) {
                            // 删除成功
                            getDataForNet(1)

                            console.log("删除成功");
                        },
                        error: function(GameScoretest, error) {
                            // 删除失败
                            alert("删除失败")
                        }
                    });
                },
                error: function(object, error) {
                    console.log("查询失败");

                }
            });

        })

    }


})